<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пример интерфейса для API</title>
    <style>
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .error-message {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Форма регистрации -->
        <div id="registrationForm" style="display: none;">
            <h2>Форма регистрации</h2>
            <div class="form-group">
                <label for="login">Логин:</label>
                <input type="text" id="login" name="login" required>
            </div>
            <div class="form-group">
                <label for="password">Пароль:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button onclick="register()">Зарегистрироваться</button>
            <p id="registrationMessage" class="error-message"></p>
        </div>

        <!-- Форма аутентификации -->
        <div id="loginForm" style="display: none;">
            <h2>Форма аутентификации</h2>
            <div class="form-group">
                <label for="loginAuth">Логин:</label>
                <input type="text" id="loginAuth" name="loginAuth" required>
            </div>
            <div class="form-group">
                <label for="passwordAuth">Пароль:</label>
                <input type="password" id="passwordAuth" name="passwordAuth" required>
            </div>
            <button onclick="login()">Войти</button>
            <p id="loginMessage" class="error-message"></p>
        </div>

        <!-- Форма данных -->
        <div id="dataForm" style="display: none;">
            <h2>Форма данных</h2>
            <button onclick="getData()">Получить данные</button>
            <p id="dataMessage" class="error-message"></p>
            <table id="dataTable" style="margin-top: 15px;">
                <thead>
                    <tr>
                        <th>Логин</th>
                        <th>Пароль</th>
                    </tr>
                </thead>
                <tbody id="dataBody">
                    <!-- Здесь будут выводиться данные -->
                </tbody>
            </table>
        </div>

        <!-- Кнопки навигации -->
        <div style="margin-top: 20px;">
            <button onclick="showRegistrationForm()">Регистрация</button>
            <button onclick="showLoginForm()">Вход</button>
            <button onclick="showDataForm()">Получить данные</button>
        </div>
    </div>

    <script>
        const apiUrl = 'https://localhost:7169/'; 

    function showRegistrationForm() {
      hideAllForms();
      document.getElementById('registrationForm').style.display = 'block';
    }

    function showLoginForm() {
      hideAllForms();
      document.getElementById('loginForm').style.display = 'block';
    }

    function showDataForm() {
      hideAllForms();
      document.getElementById('dataForm').style.display = 'block';
    }

    function hideAllForms() {
      document.getElementById('registrationForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('dataForm').style.display = 'none';
    }

    async function register() {
      const login = document.getElementById('login').value;
      const password = document.getElementById('password').value;

      try {
        const response = await fetch(`${apiUrl}/register`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ login, password })
        });

        if (!response.ok) {
          throw new Error('Ошибка регистрации');
        }

        document.getElementById('registrationMessage').textContent = 'Пользователь успешно зарегистрирован';
      } catch (error) {
        document.getElementById('registrationMessage').textContent = error.message;
      }
    }

    async function login() {
      const login = document.getElementById('loginAuth').value;
      const password = document.getElementById('passwordAuth').value;

      try {
          const response = await fetch(`https://localhost:7168/connect/token`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ login, password })
        });

        if (!response.ok) {
          throw new Error('Ошибка аутентификации');
        }

        document.getElementById('loginMessage').textContent = 'Аутентификация прошла успешно';
      } catch (error) {
        document.getElementById('loginMessage').textContent = error.message;
      }
    }

    async function getData() {
      try {
        const response = await fetch(`${apiUrl}/resource`);

        if (!response.ok) {
          throw new Error('Ошибка получения данных');
        }

        const data = await response.json();
        const tableBody = document.getElementById('dataBody');
        tableBody.innerHTML = '';

        data.forEach(item => {
          const row = document.createElement('tr');
          row.innerHTML = `<td>${item.login}</td><td>${item.password}</td>`;
          tableBody.appendChild(row);
        });

        document.getElementById('dataMessage').textContent = '';
      } catch (error) {
        document.getElementById('dataMessage').textContent = error.message;
      }
    }
    </script>
</body>
</html>
